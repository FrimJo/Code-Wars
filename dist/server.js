"use strict";
const express = require('express');
const path = require('path');
const bodyParser = require('body-parser');
const ScriptManager = require('./models/script_manager');
const SocketManager = require('./models/socket_manager');
const Arena = require('./models/arena');
// Set up App ======================
const app = express();
app.use(bodyParser.json());
app.use(express.static(__dirname + '/'));
// Set up Server ======================
const server = app.listen(3011, function () {
    let host = server.address().address;
    let port = server.address().port;
    console.log('This express app is listening on port:' + port);
});
// Set up Other ======================
const socketManager = SocketManager.init(server);
const arena = Arena.getInstance();
// Set up Routs ======================
app.post('/scripts/save', function (req, res) {
    console.log('POST: /scripts/save');
    let user_id = req.body['user_id'];
    let script = req.body['script'];
    if (user_id && script) {
        // Save script to file
        ScriptManager.saveScript(user_id, script);
        res.sendStatus(200);
        return;
    }
    res.status(500).json({ error: 'could not save script' });
});
app.post('/scripts/remove', function (req, res) {
    console.log('POST: /scripts/remove');
    res.sendStatus(200);
});
app.post('/scripts/load', function (req, res) {
    console.log('POST: /scripts/load');
    let user_id = req.body['user_id'];
    // If a user_id was provided
    if (user_id) {
        // Get script from file
        let script = ScriptManager.getScript(user_id);
        // If we found a script for provided user_id
        if (script) {
            // Send respond to client containing script
            res.status(200).send(JSON.stringify({ script: script }));
            return;
        }
    }
    res.status(500).json({ error: 'could not load script' });
});
app.post('/arenas/join', function (req, res) {
    console.log('POST: /arenas/join');
    let user_id = req.body['user_id'];
    // If a user_id was provided
    if (user_id) {
        // Add the robot to an arean
        arena.addRobot(user_id);
        res.sendStatus(200);
        return;
    }
    res.status(500).json({ error: 'could not add robot' });
});
app.post('/arenas/leave', function (req, res) {
    console.log('POST: /arenas/leave');
    let user_id = req.body['user_id'];
    // If a user_id was provided
    if (user_id) {
        // Remove the robot from an arean
        arena.removeRobot(user_id);
        res.sendStatus(200);
        return;
    }
    res.status(500).json({ error: 'could not remove robot' });
});
app.get('/reset.css', (req, res) => {
    console.log('reset.css delivered');
    res.sendFile(path.resolve(__dirname, 'reset.css'));
});
app.get('*', (req, res) => {
    res.sendFile(path.resolve(__dirname, 'index.html'));
});

//# sourceMappingURL=data:application/json;base64,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NEI7SUFDNUIsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLENBQUEsQ0FBQztRQUVYLGlDQUFpQztRQUNqQyxLQUFLLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBQzFCLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDbkIsTUFBTSxDQUFBO0lBQ1AsQ0FBQztJQUNELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLHdCQUF3QixFQUFFLENBQUMsQ0FBQTtBQUMxRCxDQUFDLENBQUMsQ0FBQTtBQUVGLEdBQUcsQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBb0IsRUFBRSxHQUFxQjtJQUNqRSxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUE7SUFDL0IsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFBO0FBQ3RELENBQUMsQ0FBQyxDQUFBO0FBRUYsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFvQixFQUFFLEdBQXFCO0lBQ3JELEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FBQTtBQUN2RCxDQUFDLENBQUMsQ0FBQSIsImZpbGUiOiJzZXJ2ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKVxuaW1wb3J0IHBhdGggPSByZXF1aXJlKCdwYXRoJylcbmltcG9ydCBib2R5UGFyc2VyID0gcmVxdWlyZSgnYm9keS1wYXJzZXInKVxuaW1wb3J0IFNjcmlwdE1hbmFnZXIgPSByZXF1aXJlKCcuL21vZGVscy9zY3JpcHRfbWFuYWdlcicpXG5pbXBvcnQgU29ja2V0TWFuYWdlciA9IHJlcXVpcmUoJy4vbW9kZWxzL3NvY2tldF9tYW5hZ2VyJylcbmltcG9ydCBBcmVuYSA9IHJlcXVpcmUoJy4vbW9kZWxzL2FyZW5hJylcblxuLy8gU2V0IHVwIEFwcCA9PT09PT09PT09PT09PT09PT09PT09XG5jb25zdCBhcHAgPSBleHByZXNzKClcbmFwcC51c2UoYm9keVBhcnNlci5qc29uKCkpXG5hcHAudXNlKGV4cHJlc3Muc3RhdGljKF9fZGlybmFtZSArICcvJykpO1xuXG4vLyBTZXQgdXAgU2VydmVyID09PT09PT09PT09PT09PT09PT09PT1cbmNvbnN0IHNlcnZlciA9IGFwcC5saXN0ZW4oMzAxMSwgZnVuY3Rpb24oKSB7XG4gICAgbGV0IGhvc3QgPSBzZXJ2ZXIuYWRkcmVzcygpLmFkZHJlc3NcbiAgICBsZXQgcG9ydCA9IHNlcnZlci5hZGRyZXNzKCkucG9ydFxuICAgIGNvbnNvbGUubG9nKCdUaGlzIGV4cHJlc3MgYXBwIGlzIGxpc3RlbmluZyBvbiBwb3J0OicgKyBwb3J0KVxufSlcblxuLy8gU2V0IHVwIE90aGVyID09PT09PT09PT09PT09PT09PT09PT1cbmNvbnN0IHNvY2tldE1hbmFnZXIgPSBTb2NrZXRNYW5hZ2VyLmluaXQoc2VydmVyKVxuY29uc3QgYXJlbmEgPSBBcmVuYS5nZXRJbnN0YW5jZSgpXG5cbi8vIFNldCB1cCBSb3V0cyA9PT09PT09PT09PT09PT09PT09PT09XG5hcHAucG9zdCgnL3NjcmlwdHMvc2F2ZScsIGZ1bmN0aW9uKHJlcSwgcmVzKXtcblx0XG5cdGNvbnNvbGUubG9nKCdQT1NUOiAvc2NyaXB0cy9zYXZlJylcblxuXHRsZXQgdXNlcl9pZCA9IHJlcS5ib2R5Wyd1c2VyX2lkJ11cblx0bGV0IHNjcmlwdCA9IHJlcS5ib2R5WydzY3JpcHQnXVxuXG5cdGlmKHVzZXJfaWQgJiYgc2NyaXB0KXtcblxuXHRcdC8vIFNhdmUgc2NyaXB0IHRvIGZpbGVcblx0XHRTY3JpcHRNYW5hZ2VyLnNhdmVTY3JpcHQodXNlcl9pZCwgc2NyaXB0KVxuXHRcdHJlcy5zZW5kU3RhdHVzKDIwMClcblx0XHRyZXR1cm5cblx0fVxuXHRyZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnY291bGQgbm90IHNhdmUgc2NyaXB0JyB9KVxuXG59KVxuXG5hcHAucG9zdCgnL3NjcmlwdHMvcmVtb3ZlJywgZnVuY3Rpb24ocmVxLCByZXMpe1xuXHRjb25zb2xlLmxvZygnUE9TVDogL3NjcmlwdHMvcmVtb3ZlJylcblx0cmVzLnNlbmRTdGF0dXMoMjAwKVxufSlcblxuYXBwLnBvc3QoJy9zY3JpcHRzL2xvYWQnLCBmdW5jdGlvbihyZXEsIHJlcyl7XG5cblx0Y29uc29sZS5sb2coJ1BPU1Q6IC9zY3JpcHRzL2xvYWQnKVxuXG5cdGxldCB1c2VyX2lkID0gcmVxLmJvZHlbJ3VzZXJfaWQnXVxuXG5cdC8vIElmIGEgdXNlcl9pZCB3YXMgcHJvdmlkZWRcblx0aWYodXNlcl9pZCl7XG5cblx0XHQvLyBHZXQgc2NyaXB0IGZyb20gZmlsZVxuXHRcdGxldCBzY3JpcHQ6IHN0cmluZyA9IFNjcmlwdE1hbmFnZXIuZ2V0U2NyaXB0KHVzZXJfaWQpXG5cblx0XHQvLyBJZiB3ZSBmb3VuZCBhIHNjcmlwdCBmb3IgcHJvdmlkZWQgdXNlcl9pZFxuXHRcdGlmKHNjcmlwdCl7XG5cblx0XHRcdC8vIFNlbmQgcmVzcG9uZCB0byBjbGllbnQgY29udGFpbmluZyBzY3JpcHRcblx0XHRcdHJlcy5zdGF0dXMoMjAwKS5zZW5kKEpTT04uc3RyaW5naWZ5KHtzY3JpcHQ6IHNjcmlwdH0pKVxuXHRcdFx0cmV0dXJuXG5cdFx0fVxuXHR9XG5cblx0cmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ2NvdWxkIG5vdCBsb2FkIHNjcmlwdCcgfSlcblxufSlcblxuYXBwLnBvc3QoJy9hcmVuYXMvam9pbicsIGZ1bmN0aW9uKHJlcSwgcmVzKXtcblx0XG5cdGNvbnNvbGUubG9nKCdQT1NUOiAvYXJlbmFzL2pvaW4nKVxuXG5cdGxldCB1c2VyX2lkID0gcmVxLmJvZHlbJ3VzZXJfaWQnXVxuXHRcblx0Ly8gSWYgYSB1c2VyX2lkIHdhcyBwcm92aWRlZFxuXHRpZih1c2VyX2lkKXtcblxuXHRcdC8vIEFkZCB0aGUgcm9ib3QgdG8gYW4gYXJlYW5cblx0XHRhcmVuYS5hZGRSb2JvdCh1c2VyX2lkKVxuXHRcdHJlcy5zZW5kU3RhdHVzKDIwMClcblx0XHRyZXR1cm5cblxuXHR9XG5cdHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdjb3VsZCBub3QgYWRkIHJvYm90JyB9KVxufSlcblxuYXBwLnBvc3QoJy9hcmVuYXMvbGVhdmUnLCBmdW5jdGlvbihyZXEsIHJlcyl7XG5cdFxuXHRjb25zb2xlLmxvZygnUE9TVDogL2FyZW5hcy9sZWF2ZScpXG5cblx0bGV0IHVzZXJfaWQgPSByZXEuYm9keVsndXNlcl9pZCddXG5cdFxuXHQvLyBJZiBhIHVzZXJfaWQgd2FzIHByb3ZpZGVkXG5cdGlmKHVzZXJfaWQpe1xuXG5cdFx0Ly8gUmVtb3ZlIHRoZSByb2JvdCBmcm9tIGFuIGFyZWFuXG5cdFx0YXJlbmEucmVtb3ZlUm9ib3QodXNlcl9pZClcblx0XHRyZXMuc2VuZFN0YXR1cygyMDApXG5cdFx0cmV0dXJuXG5cdH1cblx0cmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ2NvdWxkIG5vdCByZW1vdmUgcm9ib3QnIH0pXG59KVxuXG5hcHAuZ2V0KCcvcmVzZXQuY3NzJywgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcblx0Y29uc29sZS5sb2coJ3Jlc2V0LmNzcyBkZWxpdmVyZWQnKVxuICAgIHJlcy5zZW5kRmlsZShwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAncmVzZXQuY3NzJykpXG59KVxuXG5hcHAuZ2V0KCcqJywgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcbiAgICByZXMuc2VuZEZpbGUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJ2luZGV4Lmh0bWwnKSlcbn0pXG5cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
